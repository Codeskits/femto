var e,t;e=this,t=function(){"use strict";function c(e){h(e)&&e()}function h(e){return"function"==typeof e}var w=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e=function(){function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}}();return function(){function L(e){var t,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},s=i.playTime,n=void 0===s?5e3:s,l=i.slideMode,o=void 0===l?"fading":l,a=i.transitionTime,d=void 0===a?600:a,c=i.autoPlay,h=void 0===c||c,u=i.plugin,r=void 0===u?null:u,v=i.active3D,g=void 0!==v&&v,f=i.mode3D,p=void 0===f?1:f,m=i.slicesCount,y=void 0===m?4:m,k=i.events,b=void 0===k?{}:k;w(this,L),this.el="string"==typeof(t=e)?document.querySelector(t):t,this.settings={playTime:n,slideMode:o,transitionTime:d,autoPlay:h,plugin:r,active3D:g,slicesCount:y,mode3D:p,events:b},this.init(this.settings.plugin)}return e(L,[{key:"init",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this.slides=Array.from(this.el.querySelectorAll(".flow-slide")),this.activeSlide=this.el.querySelector(".flow-slide.is-active"),this.activeIndex=this.slides.indexOf(this.activeSlide),this.loader=this.el.querySelector(".flow-loader"),this.nextButton=this.el.querySelector(".flow-next"),this.backButton=this.el.querySelector(".flow-back"),this.sliderHeight=this.el.clientHeight,this.sliderWidth=this.el.clientWidth,this.slidesCount=this.slides.length-1,this.updating=!1,this.callbacks={},this.imagesSrc=[],this.indicators=[],this.indicatorsInit(),this.eventsInit(),this.imagesInit(),this.slideMode(),this.autoPlay(this.settings.autoPlay),c(this.settings.events.init),e&&(this.plugin=new e(this,this.settings)),this.plugin&&h(this.plugin.init)&&this.plugin.init()}},{key:"indicatorsInit",value:function(){var n=this,l=document.createElement("ul");l.classList.add("flow-dots"),this.slides.forEach(function(e,t){var i=document.createElement("li"),s=n.indicators[t]=document.createElement("a");s.classList.add("flow-dot"),s.classList.toggle("is-active",t===n.activeIndex),s.addEventListener("click",function(){return n.updateSlide(t)}),i.appendChild(s),l.appendChild(i)}),this.el.appendChild(l)}},{key:"eventsInit",value:function(){var e=this;this.nextButton&&this.nextButton.addEventListener("click",this.slideNext.bind(this),!1),this.nextButton&&this.backButton.addEventListener("click",this.slideBack.bind(this),!1),this.el.addEventListener("mousedown",this.pointerDown.bind(this),!1),this.el.addEventListener("touchstart",this.pointerDown.bind(this),!1),window.addEventListener("resize",function(){e.sliderHeight=e.el.clientHeight,e.sliderWidth=e.el.clientWidth},!1)}},{key:"imagesInit",value:function(){var s=this;this.slides.forEach(function(e,t){var i=e.querySelector(".flow-image");i?s.imagesSrc.push(i.getAttribute("src")):s.imagesSrc.push(""),e.style.backgroundImage="url('"+s.imagesSrc[t]+"')"})}},{key:"slideNext",value:function(){this.activeIndex!==this.slidesCount?(this.updateSlide(this.activeIndex+1,!0),c(this.settings.events.slideNext)):this.updateSlide(0,!0)}},{key:"slideBack",value:function(){0!==this.activeIndex?(this.updateSlide(this.activeIndex-1,!1),c(this.settings.events.slideBack)):this.updateSlide(this.slidesCount,!1)}},{key:"updateSlide",value:function(e,t){var i=this;if(!(this.updating||e>this.slidesCount)){console.log(this.updating),this.loading&&(this.loading=0),void 0===t&&(t=e>this.slides.indexOf(this.activeSlide)),this.updating=!0,console.log(e,this.activeIndex);var s,n=this.activeSlide,l=this.slides[e],o=t?"is-entering":"is-leaving",a=t?"is-leaving":"is-entering",d="is-active";if(this.indicators&&(this.indicators[this.activeIndex].classList.remove(d),this.indicators[e].classList.add(d)),setTimeout(function(){i.loader.style.transition="",i.loader.style.opacity="",i.loader.style.width="0",i.activeSlide=l,i.activeIndex=e},this.settings.transitionTime),c(this.settings.events.updating),this.plugin&&h(this.plugin.updateSlide))this.plugin.updateSlide(e);else n.classList.add(a),l.classList.add(o),s=function(){n.classList.remove(d),l.classList.remove(o),l.classList.add(d),i.updating=!1,i.loader.style.transition=i.settings.transitionTime/1e3+"s",i.loader.style.opacity="0",i.loader.style.width="100%"},setTimeout(function(){return s()},1e3/60),setTimeout(function(){n.classList.remove(a),c(i.settings.events.updated)},this.settings.transitionTime)}}},{key:"play",value:function(){var e=this;this.playingInterval=setInterval(function(){e.loading=1<e.loading?0:e.loading+e.period,e.loader.style.width=100*e.loading+"%",e.loading||e.slideNext()},1e3/60)}},{key:"pause",value:function(){clearInterval(this.playingInterval)}},{key:"autoPlay",value:function(e){e&&(this.period=1e3/60/this.settings.playTime,this.loading=this.period,this.play(),this.el.addEventListener("mouseover",this.pause.bind(this),!1),this.el.addEventListener("mouseout",this.play.bind(this),!1))}},{key:"slideMode",value:function(){var s=this;"string"!=typeof this.settings.slideMode?this.slides.forEach(function(e,t){var i=s.settings.slideMode[t]||"fading";e.classList.add("flow-"+i)}):this.slides.forEach(function(e){e.classList.add("flow-"+s.settings.slideMode)})}},{key:"pointerDown",value:function(){this.sledded=!1,this.mouseX="mousedown"===event.type?event.clientX:event.touches[0].clientX,this.mouseY="mousedown"===event.type?event.clientY:event.touches[0].clientY,this.callbacks.onDrag=this.pointerDrag.bind(this),this.callbacks.onRelease=this.pointerRelease.bind(this),document.addEventListener("mousemove",this.callbacks.onDrag,!1),document.addEventListener("mouseup",this.callbacks.onRelease,!1),document.addEventListener("touchmove",this.callbacks.onDrag,!1),document.addEventListener("touchend",this.callbacks.onRelease,!1)}},{key:"pointerDrag",value:function(){var e="mousemove"===event.type?event.clientX:event.touches[0].clientX,t="mousemove"===event.type?event.clientY:event.touches[0].clientY,i=e-this.mouseX,s=t-this.mouseY;1!==event.buttons&&"mousemove"===event.type||this.sledded||(50<i+s&&(this.slideNext(),this.sledded=!0),i+s<-50&&(this.slideBack(),this.sledded=!0))}},{key:"pointerRelease",value:function(){document.removeEventListener("mousemove",this.callbacks.onDrag),document.removeEventListener("mouseup",this.callbacks.onRelease),document.removeEventListener("touchmove",this.callbacks.onDrag),document.removeEventListener("touchend",this.callbacks.onRelease)}}],[{key:"create",value:function(e,t){return new L(e,t)}}]),L}()},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Flow=t();